<?xml version="1.0"?>
<!--

This is the anc build file for abc.
The most important tasks are:

- default:
  Build jars for abc, the abc runtime library
  and the test drivers.
- jars:           
  Build the above plus abc-complete.jar, which holds
  abc plus all its dependencies.
- clean:
  Deletes all compiled class files.
- veryclean:
  Deletes all the above plus all generated files.
- run:
  Builds abc-complete.jar and then runs it
  with your extension enabled and the
  command line arguments specified by
  ext.arguments in ant.settings.

-->

<project default="clara" name="clara">

	<target name="settings">
		<property file="ant.settings" />
		<fail message="Please copy ant.settings.template to ant.settings, and set the variables in it." unless="polyglot.loc" />
	</target>
	
	<target name="clara" depends="clara-dep,abc-ja-exts" unless="clara-up-to-date">
		<ant antfile="${clara.dir}/build.xml" dir="${clara.dir}" target="jars" inheritall="true"/>
		<copy todir="."	file="${clara.dir}/lib/clara.jar"/>
		<copy todir="."	file="${clara.dir}/lib/clara-complete.jar"/>
	</target>

	<target name="clara-dep" depends="settings">
        <condition property="clara-up-to-date">
        	<and>
    	        <available file="clara.jar"/>
    	        <available file="clara-complete.jar"/>
        	</and>
        </condition>
	</target>

	<target name="abc-ja-exts" depends="abc-ja-exts-dep,abc" unless="abc-ja-exts-up-to-date">
		<ant antfile="${abc-ja-ext.loc}/build.xml" dir="${abc-ja-ext.loc}" target="jars" inheritall="true"/>
		<copy todir="."	file="${abc-ja-ext.loc}/lib/abc-ja-exts.jar"/>
		<copy todir="."	file="${abc-ja-ext.loc}/lib/abc-ja-exts-complete.jar"/>
	</target>

	<target name="abc-ja-exts-dep" depends="settings">
        <condition property="abc-ja-exts-up-to-date">
        	<and>
    	        <available file="abc-ja-exts.jar"/>
    	        <available file="abc-ja-exts-complete.jar"/>
        	</and>
        </condition>
	</target>

	<target name="abc-ja" depends="abc-ja-dep,abc" unless="abc-ja-up-to-date">
		<ant antfile="${abc-ja.dir}/build.xml" dir="${abc-ja.dir}" target="jars" inheritall="true"/>
		<copy todir="."	file="${abc-ja.dir}/lib/abc-ja.jar"/>
		<copy todir="."	file="${abc-ja.dir}/lib/abc-ja-complete.jar"/>
	</target>

	<target name="abc-ja-dep" depends="settings">
        <condition property="abc-ja-up-to-date">
        	<and>
    	        <available file="abc-ja.jar"/>
    	        <available file="abc-ja-complete.jar"/>
        	</and>
        </condition>
	</target>

	<target name="abc" depends="abc-dep,soot" unless="abc-up-to-date">
		<ant antfile="${abc.dir}/build.xml" dir="${abc.dir}" target="jars" inheritall="true"/>
		<copy todir="."	file="${abc.dir}/lib/abc.jar"/>
		<copy todir="."	file="${abc.dir}/lib/abc-complete.jar"/>
		<copy todir="." file="${abc.dir}/lib/abc-runtime.jar"/>
		<copy todir="." file="${abc.dir}/lib/abc-testing.jar"/>
	</target>

	<target name="abc-dep" depends="settings">
        <condition property="abc-up-to-date">
        	<and>
    	        <available file="abc.jar"/>
    	        <available file="abc-complete.jar"/>
    	        <available file="abc-runtime.jar"/>
    	        <available file="abc-testing.jar"/>
        	</and>
        </condition>
	</target>
		
	<target name="soot" depends="soot-dep,jasmin" unless="soot-up-to-date">
		<ant antfile="${soot.dir}/build.xml" target="fulljar" dir="${soot.dir}" inheritall="true"/>
		<copy tofile="soot.jar" file="${soot.dir}/${release.loc}/soot-${soot.version}.jar"/>
		<copy tofile="sootclasses.jar" file="${soot.dir}/${release.loc}/sootclasses-${soot.version}.jar"/>
	</target>

	<target name="soot-dep" depends="settings">
        <condition property="soot-up-to-date">
	        <available file="soot.jar"/>
        </condition>
	</target>

	<target name="jasmin" depends="jasmin-dep" unless="jasmin-up-to-date">
		<ant antfile="${jasmin.dir}/build.xml" target="jasmin-jar" dir="${jasmin.dir}" inheritall="true"/>
		<copy tofile="jasminclasses.jar" file="${jasmin.dir}/${release.loc}/jasminclasses-${jasmin.version}.jar"/>
	</target>

	<target name="jasmin-dep" depends="settings">
        <condition property="jasmin-up-to-date">
	        <available file="jasminclasses.jar"/>
        </condition>
	</target>
</project>
